<ng-container
*ngIf="!products;
then LoadingSpinner,
else AddMeals;
">
</ng-container>



<ng-template #LoadingSpinner>
	<app-loading-circle></app-loading-circle>
</ng-template>

<ng-template #AddMeals>
	<div class="meals-container">

		<div class="text-center">
			<h2 class='text-2xl py-5'>Posiłki</h2>
			<button class="btn btn-toggle" (click)="toggleList('add-meal', 0)">Dodaj Posiłek</button>
		</div>

		<div class="add-meal-card" *ngIf="toggleAddMealCard">
			<div class="meal-card-box">
				<label for="meal-header">Tytuł: </label>
				<input
				type="text"
				id='meal-header'
				class='custom-input'
				[(ngModel)]="productData.title"
				placeholder='Max. 80 znaków'
				maxlength="80"
				>
			</div>
			<div class="meal-card-box">
				<label for="meal-description">Opis: </label>
				<input
				type="text"
				id='meal-description'
				class='custom-input'
				[(ngModel)]="productData.description"
				placeholder='Max. 250 znaków'
				maxlength='250'
				>
			</div>
			<div class="meal-card-box additional-select">
				<select
				name="select-product"
				id="select-product"
				[(ngModel)]="selectedProduct"
				(change)="onProductChange()"
				class='mb-4'
				>
					<option [ngValue]="null" selected disabled>-Wybierz produkt-</option>
					<option [value]="product.id_prod" *ngFor="let product of products">{{product.name}}</option>
				</select>
				<input
				type="number"
				id='weight'
				[(ngModel)]="productWeight.weight"
				min='0'
				placeholder='Waga produktu'
				class='text-center'
				>
			</div>
			<div class="meal-card-box additional-details" *ngIf="selectedProductDetails">
				<!-- Description -->
				<span>Kalorie: <p>{{selectedProductDetails.productDetails.kcal}}g</p></span>
				<span>Węgle: <p>{{selectedProductDetails.productDetails.carbohydrates}}g</p></span>
				<span>Tłuszcze: <p>{{selectedProductDetails.productDetails.fats}}g</p></span>
				<span>Białka: <p>{{selectedProductDetails.productDetails.proteins}}g</p></span> <br>
			</div>

			<button class='btn btn-add' (click)="addProductToTable()">Dodaj</button>
		</div>
		<div class="meal-card-box products">
			<div class='products-wrapper' *ngFor="let product of mealDetails; let i = index">
				<p>Produkt: {{product.name}}</p>
				<div class='product'>
					<span class='cursor-pointer font-semibold text-sm' (click)="toggleList('description', i)">Szczegóły: [g]</span>
					<div  class='product-details' *ngIf="product.showDescription">
						<p class='meal-description'>Waga: {{product.weight.toFixed(2)}}</p>
						<p class='meal-description'>Kcal: {{product.productDetails.kcal.toFixed(2)}}</p>
						<p class='meal-description'>Węgle: {{product.productDetails.carbohydrates.toFixed(2)}}</p>
						<p class='meal-description'>Tłuszcze: {{product.productDetails.fats.toFixed(2)}}</p>
						<p class='meal-description'>Białka: {{product.productDetails.proteins.toFixed(2)}}</p>
					</div>
					<div>
						<button class='btn btn-delete my-2 mx-4 p-2' (click)="deleteMealsProduct(i)">Usuń</button>
						<button class='btn btn-edit my-2 mx-4 p-2' (click)="toggleList('edit-mode', i)">Edytuj wagę</button>
					</div>
				</div>

				<div *ngIf="product.editMode">
					<input
					type="number"
					id='weight'
					[(ngModel)]="productWeight.newWeight"
					min='0'
					placeholder='Waga produktu'
					class='text-center'>
					<button class='btn btn-add' (click)="editMealFromTable(i)">Zapisz</button>
				</div>
			</div>

			<button class="btn btn-save my-3" (click)="saveMeal()">Zatwierdź</button>

			<div *ngIf="handler.state" class='handler'>
				<span class='message'>{{handler.message}}</span>
			</div>
		</div>

		<div class="meal-card-box">
			<ng-container
			*ngIf="!meals;
			then LoadingSpinner;
			else ListOfMeals
			"></ng-container>
		</div>


	</div>


</ng-template>

<ng-template #ListOfMeals>
	<div class='meal-table' *ngIf="meals">
			<div *ngFor="let meal of meals.details; let i = index" class='meal-table-item'>
				<p class='date'>{{meal.date | date:'yyyy/MM/dd'}}</p>
				<h4 class='title'>{{meal.title}}</h4>
				<p class='description' max='10'>{{meal.description}}</p>
				<button class='btn btn-show' (click)="toggleList('details',i)"> {{detailsIndex === i ?  "Ukryj Szczegóły" : "Pokaż szczegóły"}}</button>
				<div *ngFor="let product of meal.meals" class='item-details'>
					<div>
						<p class='name'>Nazwa: {{product.name}}</p>
						<p class='weight'>Waga: {{product.weight}}g</p>
						<span class='product-details'  *ngIf="detailsIndex === i">
							<p>Kcal: {{product.productDetails.kcal.toFixed(2)}}g</p>
							<p>Tłuszcze: {{product.productDetails.fats.toFixed(2)}}g</p>
							<p>Białko: {{product.productDetails.proteins.toFixed(2)}}g</p>
							<p>Węgle: {{product.productDetails.carbohydrates.toFixed(2)}}g</p>
						</span>
					</div>
				</div>
			</div>
	</div>
</ng-template>


